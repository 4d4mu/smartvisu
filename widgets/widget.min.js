/* smartVISU, Martin GleiÃŸ, 2012 - 2015, GPL [http://www.gnu.de] */
$(document).on("pagebeforeshow",function(p,h){1!=$.mobile.activePage.data("sv-events-bound")&&($.mobile.activePage.data("sv-events-bound",!0),$.mobile.activePage.find('span[data-widget="basic.activelist"]').on({update:function(c,b){b==$(this).attr("data-val-on")?($("#"+this.id+" img").attr("src",$(this).attr("data-pic-on")),$("#"+this.id).show()):($("#"+this.id+" img").attr("src",$(this).attr("data-pic-off")),$("#"+this.id).hide())},click:function(c){$("#"+this.id+" img").attr("src")==$(this).attr("data-pic-off")?
io.write($(this).attr("data-item"),$(this).attr("data-val-on")):io.write($(this).attr("data-item"),$(this).attr("data-val-off"))}}),$.mobile.activePage.find('span[data-widget="basic.activelist2"]').on({update:function(c,b){a==$(this).attr("data-val-on")?$(this).show():$(this).hide()},click:function(c){io.write($(this).attr("data-item"),$(this).attr("data-val-off"))}}),$.mobile.activePage.find('a[data-widget="basic.button"]').on({click:function(c){""!=$(this).attr("data-val")&&io.write($(this).attr("data-item"),
$(this).attr("data-val"))}}),$.mobile.activePage.find('input[data-widget="basic.checkbox"]').on({update:function(c,b){c.stopPropagation();$(this).prop("checked",0!=b).checkboxradio("refresh")},change:function(c){io.write($(this).attr("data-item"),$(this).prop("checked")?1:0)}}),$.mobile.activePage.find('a[data-widget="basic.colordisc"]').on({update:function(c,b){c.stopPropagation();var d=$(this).attr("data-max");$("#"+this.id+" span").css("background-color","rgb("+Math.round(b[0]/d*255)+","+Math.round(b[1]/
d*255)+","+Math.round(b[2]/d*255)+")")},click:function(c){$("#"+this.id+"-screen").removeClass("hide").addClass("in");var b=$(this).offset();c=$("#"+this.id+"-disc");var d=b.top-c.height()/2+15,b=b.left-c.width()/2+25;c.css("top",d.limit(5,$(window).height()+$(document).scrollTop()-c.height()-5,1));c.css("left",b.limit(5,$(window).width()-c.width()-5,1));c.show()}}),$.mobile.activePage.find('div[data-widget="basic.colordisc"]').on({click:function(c){c=this.id.substr(0,this.id.length-7);$("#"+c+"-disc").hide();
$("#"+c+"-screen").removeClass("in").addClass("hide")}}),$.mobile.activePage.find('canvas[data-widget="basic.colordisc"]').on({click:function(c){var b=this.id.substr(0,this.id.length-5),d=$(this)[0].getContext("2d"),e=$(this).offset();c=d.getImageData(Math.round(c.pageX-e.left),Math.round(c.pageY-e.top),1,1).data;d=$("#"+b).attr("data-max");e=$("#"+b).attr("data-item").explode();io.write(e[0],Math.round(c[0]/255*d));io.write(e[1],Math.round(c[1]/255*d));io.write(e[2],Math.round(c[2]/255*d));$(this).hide();
$("#"+b+"-screen").removeClass("in").addClass("hide")}}),$.mobile.activePage.find('a[data-widget="basic.dual"]').on({update:function(c,b){c.stopPropagation();$(this).val(b);$(this).trigger("draw")},draw:function(c){c.stopPropagation();$(this).val()==$(this).attr("data-val-on")?($("#"+this.id+"-off").hide(),$("#"+this.id+"-on").show()):($("#"+this.id+"-on").hide(),$("#"+this.id+"-off").show())},click:function(c){io.write($(this).attr("data-item"),$(this).val()==$(this).attr("data-val-off")?$(this).attr("data-val-on"):
$(this).attr("data-val-off"))}}),$.mobile.activePage.find('a[data-widget="basic.multistate"]').on({update:function(c,b){c.stopPropagation();list_val=$(this).attr("data-vals").explode();list_img=$(this).attr("data-img").explode();idx=list_val.indexOf(b.toString());$("#"+this.id+" img").attr("src",list_img[idx]);$(this).attr("data-value",idx)},click:function(c){list_val=$(this).attr("data-vals").explode();old_idx=parseInt($(this).attr("data-value"));c=old_idx+1;c>=list_val.length&&(c=0);io.write($(this).attr("data-item"),
list_val[c]);$(this).attr("data-value",c)}}),$.mobile.activePage.find('select[data-widget="basic.flip"]').on({update:function(c,b){c.stopPropagation();$(this).val(0<b?"on":"off").slider("refresh")},change:function(c){io.write($(this).attr("data-item"),"on"==$(this).val()?1:0)}}),$.mobile.activePage.find('[data-widget="basic.float"]').on({update:function(c,b){c.stopPropagation();""!=$(this).attr("data-unit")?$("#"+this.id).html(parseFloat(b).transUnit($(this).attr("data-unit"))):$("#"+this.id).html(parseFloat(b).transFloat())}}),
$.mobile.activePage.find('[data-widget="basic.formula"]').on({update:function(c,b){c.stopPropagation();var d=0,e=0,f=$(this).attr("data-unit"),g=$(this).attr("data-formula").substring(0,3),n=$(this).attr("data-formula");if("date"==f||"time"==f||"short"==f||"long"==f)d=new Date(b[0]),$("#"+this.id).html(d.transUnit(f));else{if(-1<n.indexOf("VAR1")){for(e=0;e<b.length;e++)n=eval("formula.replace(/VAR"+(e+1)+"/g, response[i]);");d=eval(n)}else{"SUB"==g&&(d=b[e],e++);for(;e<b.length;e++)d="SUB"==g?d-
b[e]:d+b[e];"AVG"==g&&(d/=e);""!=g&&(d=eval(n.replace(/VAR/g,d).replace(/AVG/g,"").replace(/SUM/g,"").replace(/SUB/g,"")))}$("#"+this.id).html(parseFloat(d).transUnit(f))}}}),$.mobile.activePage.find('a[data-widget="basic.rgb"]').on({update:function(c,b){c.stopPropagation();var d=$(this).attr("data-max");$("#"+this.id+" span").css("background-color","rgb("+Math.round(b[0]/d*255)+","+Math.round(b[1]/d*255)+","+Math.round(b[2]/d*255)+")")}}),$.mobile.activePage.find('div[data-widget="basic.rgb-popup"] > div').on({click:function(c){c=
$(this).css("background-color");c=c.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);var b=$(this).parent().attr("data-max"),d=$(this).parent().attr("data-item").explode();io.write(d[0],Math.round(c[1]/255*b));io.write(d[1],Math.round(c[2]/255*b));io.write(d[2],Math.round(c[3]/255*b));$(this).parent().popup("close")},mouseenter:function(c){$(this).addClass("ui-focus")},mouseleave:function(c){$(this).removeClass("ui-focus")}}),$.mobile.activePage.find('span[data-widget="basic.shifter"]').on({update:function(c,
b){c.stopPropagation();var d=Math.min(10*(b[0]/$(this).attr("data-max")*10+.49).toFixed(0),100);0!=b[1]&&0<d?$("#"+this.id+" img").attr("src",$(this).attr("data-pic-on").replace("00",d)):$("#"+this.id+" img").attr("src",$(this).attr("data-pic-off"))},click:function(c){c=$(this).attr("data-item").explode();$("#"+this.id+" img").attr("src")==$(this).attr("data-pic-off")?io.write(c[1],1):io.write(c[1],0)}}),$(document).delegate('span[data-widget="basic.shifter"] > a > img',"hover",function(c){"mouseenter"===
c.type?$(this).addClass("ui-focus"):$(this).removeClass("ui-focus")}),$.mobile.activePage.find('div[data-widget="basic.shutter"]').on({update:function(c,b){c.stopPropagation();var d=13,e="half"==$(this).attr("data-mode")?.5:1;void 0!==b[1]&&(d=parseInt(13/e*(b[1]/$(this).attr("data-max")+e-1)));for(var f=parseInt(182*b[0]/$(this).attr("data-max")),g=12;1<=g;g--)if(14<=f){var n=13-Math.abs(d),e="height: "+(f>14*g&&13==d?14-n:15-n)+"px;",e=13!=d?e+("margin-top: "+(14<=f-15?n:parseInt(n/2))+"px;"):e+
("border-top: 1px dotted "+(f>14*g?"#ccc":"#333")+";");0<d?$("#"+this.id+"-"+g).attr("class","blade-pos"):$("#"+this.id+"-"+g).attr("class","blade-neg");$("#"+this.id+"-"+g).attr("style",e);f-=15}else e="height: "+f+"px;",e+="border-top: 1px dotted #aaa;",$("#"+this.id+"-"+g).attr("style",e),f=1},click:function(c){var b=$(this).offset(),d=Math.round(c.pageX-b.left);c=Math.floor(((c.pageY-b.top)/160-.0625)*$(this).attr("data-max")/$(this).attr("data-step"))*$(this).attr("data-step");c=c.limit($(this).attr("data-min"),
$(this).attr("data-max"),1);b=$(this).attr("data-item").explode();""!=b[1]&&52<d?io.write(b[1],c):io.write(b[0],c)},mouseenter:function(c){$("#"+this.id+" .control").fadeIn(400)},mouseleave:function(c){$("#"+this.id+" .control").fadeOut(400)}}),$.mobile.activePage.find('input[data-widget="basic.slider"]').on({update:function(c,b){c.stopPropagation();$(this).attr("lock",1);$("#"+this.id).val(b).slider("refresh").attr("mem",$(this).val())},slidestop:function(c){$(this).val()!=$(this).attr("mem")&&io.write($(this).attr("data-item"),
$(this).val())},change:function(c){(void 0===$(this).attr("timer")||0==$(this).attr("timer")&&0==$(this).attr("lock"))&&$(this).val()!=$(this).attr("mem")&&(void 0!==$(this).attr("timer")&&$(this).trigger("click"),$(this).attr("timer",1),setTimeout("$('#"+this.id+"').attr('timer', 0);",400));$(this).attr("lock",0)},click:function(c){io.write($(this).attr("data-item"),$(this).val())}}),$.mobile.activePage.find('span[data-widget="basic.switch"]').on({update:function(c,b){c.stopPropagation();$(this).val(b);
$(this).trigger("draw")},draw:function(c){c.stopPropagation();$(this).val()==$(this).attr("data-val-on")?($("#"+this.id+"-off").hide(),$("#"+this.id+"-on").show()):($("#"+this.id+"-on").hide(),$("#"+this.id+"-off").show())},click:function(c){io.write($(this).attr("data-item"),$(this).val()==$(this).attr("data-val-off")?$(this).attr("data-val-on"):$(this).attr("data-val-off"))}}),$.mobile.activePage.find('span[data-widget="basic.switch.v1"]').on({update:function(c,b){c.stopPropagation();$("#"+this.id+
" img").attr("src",b==$(this).attr("data-val-on")?$(this).attr("data-pic-on"):$(this).attr("data-pic-off"))},click:function(c){$("#"+this.id+" img").attr("src")==$(this).attr("data-pic-off")?io.write($(this).attr("data-item"),$(this).attr("data-val-on")):io.write($(this).attr("data-item"),$(this).attr("data-val-off"))}}),$.mobile.activePage.find('span[data-widget="basic.switch.v1"] > a > img',"hover").on(function(c,b){"mouseenter"===c.type?$(this).addClass("ui-focus"):$(this).removeClass("ui-focus")}),
$.mobile.activePage.find('span[data-widget="basic.symbol"]').on({update:function(c,b){c.stopPropagation();var d="and"==$(this).attr("data-mode");if(b instanceof Array)for(var e=0;e<b.length;e++)d="and"==$(this).attr("data-mode")?d&&b[e]==$(this).attr("data-val"):d||b[e]==$(this).attr("data-val");else d=b==$(this).attr("data-val");$("#"+this.id+" img").attr("title",new Date);d?$("#"+this.id).show():$("#"+this.id).hide()}}),$.mobile.activePage.find('div[data-widget="basic.tank"]').on({update:function(c,
b){c.stopPropagation();$("#"+this.id+" div").css("height",Math.round(180*Math.min(b/$(this).attr("data-max"),1)))}}),$.mobile.activePage.find('[data-widget="basic.text"]').on({update:function(c,b){c.stopPropagation();$("#"+this.id).html(b==$(this).attr("data-val-on")?$(this).attr("data-txt-on"):$(this).attr("data-txt-off"))}}),$.mobile.activePage.find('a[data-widget="basic.trigger"]').on({click:function(c){io.trigger($(this).attr("data-name"),$(this).attr("data-val"))}}),$.mobile.activePage.find('[data-widget="basic.value"]').on({update:function(c,
b){c.stopPropagation();var d=$(this).attr("data-unit");if("date"==d||"time"==d||"short"==d||"long"==d){var e=new Date(b);$("#"+this.id).html(e.transUnit(d))}else""!=d&&$.isNumeric(b)?$("#"+this.id).html(parseFloat(b).transUnit(d)):$("#"+this.id).html(b)}}),$.mobile.activePage.find('span[data-widget="clock.iconclock"]').on({repeat:function(c){c.stopPropagation();c=Math.floor((new Date-(new Date).setHours(0,0,0,0))/1E3/60);$("#"+this.id+" svg").trigger("update",[[c],[0]])}}),$.mobile.activePage.find('span[data-widget="clock.miniclock"]').on({repeat:function(c){c.stopPropagation();
c=new Date;$(".miniclock").html(c.getHours()+":"+(10>c.getMinutes()?"0"+c.getMinutes():c.getMinutes()))}}),$.mobile.activePage.find('div[data-widget="device.codepad"]').on({keyup:function(c){13==c.keyCode&&$("#"+this.id+"-ok").click()},click:function(c){$(this).attr("data-access")||($(this).popup("open"),$(this).val("").focus())}}),$.mobile.activePage.find('div[data-widget="device.codepad"] > div > a').on({click:function(c){var b=$(this).parent().parent();c=$("#"+b.attr("id")+"-code");var d=$(this).attr("data-val");
"ok"==d?b.attr("data-val")==c.val().md5()?($('div[data-bind="'+b.attr("data-id")+'"]').attr("data-access",(new Date).getTime()).removeClass("codepad"),setTimeout(function(){$('div[data-bind="'+b.attr("data-id")+'"]').attr("data-access","").addClass("codepad")},(new Date).duration(b.attr("data-duration")).valueOf()),b.popup("close"),b.data("originally-clicked").trigger("click")):(c.val(""),$("#"+b.attr("id")).addClass("ui-focus"),setTimeout(function(){$("#"+b.attr("id")).removeClass("ui-focus")},400)):
"-"==d?c.val(""):c.val(c.val()+d)}}),$.mobile.activePage.find('div[data-widget="device.rtr"] > div > a[data-icon="minus"]').on({click:function(c,b){var d=$(this).parent().parent().attr("id"),e=$("#"+d).attr("data-step"),d=$("#"+d+"set").attr("data-item"),e=(Math.round(10*(widget.get(d)-e))/10).toFixed(1);io.write(d,e)}}),$.mobile.activePage.find('div[data-widget="device.rtr"] > div > a[data-icon="plus"]').on({click:function(c,b){var d=$(this).parent().parent().attr("id"),e=$("#"+d).attr("data-step"),
d=$("#"+d+"set").attr("data-item"),e=(Math.round(10*(1*widget.get(d)+1*e))/10).toFixed(1);io.write(d,e)}}),$.mobile.activePage.find('div[data-widget="plot.comfortchart"]').on({update:function(c,b){c.stopPropagation();var d=$(this).attr("data-label").explode(),e=$(this).attr("data-axis").explode(),f=[];f[0]={type:"area",name:d[0],lineWidth:0,data:[[17,35],[16,75],[17,85],[21,80],[25,60],[27,35],[25,19],[20,20],[17,35]]};f[1]={type:"area",name:d[1],lineWidth:0,data:[[17,75],[22.5,65],[25,33],[18.5,
35],[17,75]]};f[2]={name:"point",data:[[1*b[0],1*b[1]]],marker:{enabled:!0,lineWidth:2,radius:6,symbol:"circle"},showInLegend:!1};$("#"+this.id).highcharts({series:f,xAxis:{min:10,max:35,title:{text:e[0],align:"high",margin:-2}},yAxis:{min:0,max:100,title:{text:e[1],margin:7}},plotOptions:{area:{enableMouseTracking:!1}},tooltip:{formatter:function(){return this.x.transUnit("temp")+" / "+this.y.transUnit("%")}}})},point:function(c,b){c.stopPropagation();var d=$("#"+this.id).highcharts(),e=d.series[2].data[0];
b[0]||(b[0]=e.x);b[1]||(b[1]=e.y);d.series[2].data[0].update([1*b[0],1*b[1]],!0)}}),$.mobile.activePage.find('div[data-widget="plot.multiaxis"]').on({update:function(c,b){c.stopPropagation();var d=[];$(this).attr("data-ymin")&&(d=$(this).attr("data-ymin").explode());var e=[];$(this).attr("data-ymax")&&(e=$(this).attr("data-ymax").explode());var f=$(this).attr("data-label").explode(),g=$(this).attr("data-color").explode(),n=$(this).attr("data-exposure").explode(),h=$(this).attr("data-axis").explode(),
m=$(this).attr("data-zoom"),q=[];$(this).attr("data-assign")&&(q=$(this).attr("data-assign").explode());var p=[];$(this).attr("data-opposite")&&(p=$(this).attr("data-opposite").explode());var t=[];$(this).attr("data-ycolor")&&(t=$(this).attr("data-ycolor").explode());var u=[],r=[],l;for(l=0;l<b.length;l++)u[l]={type:"stair"!=n[l]?n[l]:"line",step:"stair"==n[l]?"left":!1,name:f[l],data:b[l],color:g[l]?g[l]:null,yAxis:q[l]?q[l]-1:0};for(l=0;l<h.length-1;l++)r[l]={min:d[l]?d[l]:null,max:e[l]?e[l]:null,
title:{text:h[l+1]},opposite:0<p[l],minPadding:.05,maxPadding:.05,endOnTick:!1,startOnTick:!1},t[l]&&(r[l].lineColor=t[l],r[l].tickColor=t[l]);m?$("#"+this.id).highcharts({chart:{zoomType:"x"},series:u,xAxis:{type:"datetime",title:{text:h[0]},minRange:(new Date).duration(m).valueOf()},yAxis:r}):$("#"+this.id).highcharts({series:u,xAxis:{type:"datetime",title:{text:h[0]}},yAxis:r})},point:function(c,b){c.stopPropagation();var d=$(this).attr("data-count");1>d&&(d=100);for(var e=0;e<b.length;e++)if(b[e]){for(var f=
$("#"+this.id).highcharts(),g=0;g<b[e].length;g++)f.series[e].addPoint(b[e][g],!1,f.series[e].data.length>=d);f.redraw()}}}),$.mobile.activePage.find('div[data-widget="plot.period"]').on({update:function(c,b){c.stopPropagation();for(var d=$(this).attr("data-label").explode(),e=$(this).attr("data-color").explode(),f=$(this).attr("data-exposure").explode(),g=$(this).attr("data-axis").explode(),h=$(this).attr("data-zoom"),k=[],m=0;m<b.length;m++)k[m]={type:"stair"!=f[m]?f[m]:"line",step:"stair"==f[m]?
"left":!1,name:d[m],data:b[m],color:e[m]?e[m]:null};h?$("#"+this.id).highcharts({chart:{zoomType:"x"},series:k,xAxis:{type:"datetime",title:{text:g[0]},minRange:(new Date).duration(h).valueOf()},yAxis:{min:$(this).attr("data-ymin"),max:$(this).attr("data-ymax"),title:{text:g[1]}}}):$("#"+this.id).highcharts({series:k,xAxis:{type:"datetime",title:{text:g[0]}},yAxis:{min:$(this).attr("data-ymin"),max:$(this).attr("data-ymax"),title:{text:g[1]}}})},point:function(c,b){c.stopPropagation();var d=$(this).attr("data-count");
1>d&&(d=100);for(var e=0;e<b.length;e++)if(b[e]){for(var f=$("#"+this.id).highcharts(),g=0;g<b[e].length;g++)f.series[e].addPoint(b[e][g],!1,f.series[e].data.length>=d);f.redraw()}}}),$.mobile.activePage.find('div[data-widget="plot.rtr"]').on({update:function(c,b){c.stopPropagation();for(var d=$(this).attr("data-label").explode(),e=$(this).attr("data-axis").explode(),f=b[2],g=f[0][0],h=0,k=1;k<f.length;k++)h+=f[k-1][1]*(f[k][0]-g),g=f[k][0];h/=g-f[0][0];1>h?h*=100:100<h&&(h=h/255*100);$("#"+this.id).highcharts({chart:{type:"line"},
series:[{name:d[0],data:b[0],type:"spline"},{name:d[1],data:b[1],dashStyle:"shortdot",step:"left"},{type:"pie",name:"\u2211  On: ",data:[{name:"On",y:h},{name:"Off",y:100-h,color:null}],center:["95%","90%"],size:35,showInLegend:!1,dataLabels:{enabled:!1}}],xAxis:{type:"datetime"},yAxis:{min:$(this).attr("data-min"),max:$(this).attr("data-max"),title:{text:e[1]}},tooltip:{formatter:function(){return this.series.name+" <b>"+(this.percentage?this.y.transUnit("%"):this.y.transUnit("temp"))+"</b>"}}})},
point:function(c,b){c.stopPropagation();var d=$(this).attr("data-count");1>d&&(d=100);for(var e=0;e<b.length;e++){var f=$("#"+this.id).highcharts();if(b[e]&&(0==e||1==e))for(var g=0;g<b[e].length;g++)f.series[e].addPoint(b[e][g],!1,f.series[e].data.length>=d);f.redraw()}}}),$.mobile.activePage.find('div[data-widget="plot.temprose"]').on({update:function(c,b){c.stopPropagation();var d=$(this).attr("data-label").explode(),e=$(this).attr("data-axis").explode(),f=parseInt($(this).attr("data-count")),
g=[];g[0]={name:d[0],pointPlacement:"on",data:b.slice(0,f)};b.slice(f).length==f&&(g[1]={name:d[1],pointPlacement:"on",data:b.slice(f),dashStyle:"shortdot"});$("#"+this.id).highcharts({chart:{polar:!0,type:"line",marginLeft:10},series:g,xAxis:{categories:e,tickmarkPlacement:"on",lineWidth:0},yAxis:{gridLineInterpolation:"polygon",lineWidth:0},tooltip:{formatter:function(){return this.x+" - "+this.series.name+": <b>"+this.y.transUnit("temp")+"</b>"}},legend:{x:10,layout:"vertical"}})},point:function(c,
b){c.stopPropagation();var d=$("#"+this.id).highcharts(),e=d.series[2].data[0];b[0]||(b[0]=e.x);b[1]||(b[1]=e.y);d.series[2].data[0].update([1*b[0],1*b[1]],!0)}}),$.mobile.activePage.find('div[data-widget="plot.minmaxavg"]').on({update:function(c,b){c.stopPropagation();for(var d=$(this).attr("data-axis").explode(),e=$(this).attr("data-unit"),f=b[0],g=b[1],h=[],k=0;k<f.length;k++)h[k]=[f[k][0],f[k][1],g[k][1]];$("#"+this.id).highcharts({chart:{type:"columnrange",inverted:!1},series:[{data:h,enableMouseTracking:!1},
{type:"line",data:b[2]}],xAxis:{type:"datetime",title:{text:d[0]}},yAxis:{min:$(this).attr("data-ymin"),max:$(this).attr("data-ymax"),title:{text:d[1]}},plotOptions:{columnrange:{dataLabels:{enabled:!0,formatter:function(){return""!=e?parseFloat(this.y).transUnit(e):parseFloat(this.y).transFloat()}}}},tooltip:{pointFormatter:function(){var b;b=""!=e?parseFloat(this.y).transUnit(e):parseFloat(this.y).transFloat();return'<span style="color:'+this.color+'">\u00d8</span>  <b>'+b+"</b><br/>"}},legend:{enabled:!1}})},
point:function(c,b){c.stopPropagation();var d=$(this).attr("data-count");1>d&&(d=100);for(var e=b[0],f=b[1],g=0;g<e.length;g++){var h=$("#"+this.id).highcharts();h.series[0].addPoint([e[g][0],e[g][1],f[g][1]],!1,h.series[g].data.length>=d);h.series[1].addPoint(b[2][g],!1,h.series[g].data.length>=d);h.redraw()}}}),$.mobile.activePage.find('span[data-widget="status.collapse"]').on({update:function(c,b){c.stopPropagation();var d=$('div[data-bind="'+$(this).attr("data-id")+'"]');0!=b[0]?(d.not(".ui-collapsible").not(".ui-popup").show(),
d.filter(".ui-collapsible").trigger("expand"),d.filter(".ui-popup").popup("open")):(d.not(".ui-collapsible").not(".ui-popup").hide(),d.filter(".ui-collapsible").trigger("collapse"),d.filter(".ui-popup").popup("close"))}}),$.mobile.activePage.find('span[data-widget="status.log"]').on({update:function(c,b){c.stopPropagation();var d,e="";if(b[0]instanceof Array){for(var f=b[0].slice(0,$(this).attr("data-count")),g=0;g<f.length;g++)d='<div class="color '+f[g].level.toLowerCase()+'"></div>',d+="<h3>"+
(new Date(f[g].time)).transLong()+"</h3>",d+="<p>"+f[g].message+"</p>",e+='<li data-icon="false">'+d+"</li>";$("#"+this.id+" ul").html(e).trigger("prepare").listview("refresh").trigger("redraw")}}}),$.mobile.activePage.find('span[data-widget="status.notify"]').on({update:function(c,b){c.stopPropagation();0!=b[0]&&(notify.add($(this).attr("data-mode"),$(this).attr("data-signal"),$("#"+this.id+" h1").html(),"<b>"+b[1]+"</b><br  />"+$("#"+this.id+" p").html()),notify.display())}}),$.mobile.activePage.find('span[data-widget="status.message"]').on({update:function(c,
b){c.stopPropagation();0!=b[0]?($("#"+this.id+"-message p span").html(b[1]?"<b>"+b[1]+"</b><br />":""),$("#"+this.id+"-message .stamp").html(b[2]?(new Date(b[2])).transShort():(new Date).transShort()),$("#"+this.id+"-message").popup("open")):$("#"+this.id+"-message").popup("close")}}),$.mobile.activePage.find('svg[data-widget^="icon."]').on({update:function(c,b){c.stopPropagation();b instanceof Array&&this.setAttributeNS(null,"class","icon"+(b[0]&&b[1]?" icon1":" icon0"))},click:function(c){$(this).attr("data-item")&&
(c=$(this).attr("data-item").explode(),c[1]&&io.write(c[1],0==widget.get(c[1])?1:0))}}),$.mobile.activePage.find('svg[data-widget="icon.arrow"]').on({update:function(c,b){c.stopPropagation();var d=b[0]/$(this).attr("data-max")*2*Math.PI,e=[],e=e.concat([50,50],fx.rotate([25,50],d,[50,50]),fx.rotate([50,18],d,[50,50]),fx.rotate([75,50],d,[50,50]),[50,50]);$("#"+this.id+" #line0").attr("points",e.toString());e=[];e=e.concat(fx.rotate([32,50],d,[50,50]),fx.rotate([32,60],d,[50,50]),fx.rotate([68,60],
d,[50,50]),fx.rotate([68,50],d,[50,50]));$("#"+this.id+" #line1").attr("points",e.toString())}}),$.mobile.activePage.find('svg[data-widget="icon.battery"]').on({update:function(c,b){c.stopPropagation();var d=6*Math.floor(b[0]/$(this).attr("data-max")*40/6);fx.grid(this,d,[39,68],[61,28])}}),$.mobile.activePage.find('svg[data-widget="icon.blade"]').on({update:function(c,b){c.stopPropagation();for(var d=b[0]/$(this).attr("data-max")*.4*Math.PI,e,f=0;3>=f;f++)e=[],e=e.concat(fx.rotate([37,20+20*f],d,
[50,20+20*f]),fx.rotate([63,20+20*f],d,[50,20+20*f])),$("#"+this.id+" #blade"+f).attr("points",e.toString())}}),$.mobile.activePage.find('svg[data-widget="icon.blade_z"]').on({update:function(c,b){c.stopPropagation();var d=b[0]/$(this).attr("data-max")*.5*Math.PI*-1,e=[],e=e.concat(fx.rotate([25,25],d,[50,30]),fx.rotate([45,25],d,[50,30]),fx.rotate([55,35],d,[50,30]),fx.rotate([75,35],d,[50,30]));$("#"+this.id+" #blade0").attr("points",e.toString());e=[];e=e.concat(fx.rotate([25,65],d,[50,70]),fx.rotate([45,
65],d,[50,70]),fx.rotate([55,75],d,[50,70]),fx.rotate([75,75],d,[50,70]));$("#"+this.id+" #blade1").attr("points",e.toString())}}),$.mobile.activePage.find('svg[data-widget="icon.blade_arc"]').on({update:function(c,b){c.stopPropagation();var d=b[0]/$(this).attr("data-max")*-.7*Math.PI+.35*Math.PI,e;e="M "+fx.rotate([30,40],d,[50,37])+" Q "+fx.rotate([50,22],d,[50,30])+" "+fx.rotate([70,40],d,[50,37]);$("#"+this.id+" #blade0").attr("d",e);e="M "+fx.rotate([30,80],d,[50,77])+" Q "+fx.rotate([50,62],
d,[50,70])+" "+fx.rotate([70,80],d,[50,77]);$("#"+this.id+" #blade1").attr("d",e)}}),$.mobile.activePage.find('svg[data-widget="icon.clock"]').on({update:function(c,b){c.stopPropagation();var d=b[0]%60/60*2*Math.PI;$("#"+this.id+" #hand_l").attr("points","50,50 "+fx.rotate([50,30],d,[50,50]).toString());d=5*Math.floor(b[0]/60)/60*2*Math.PI;$("#"+this.id+" #hand_s").attr("points","50,50 "+fx.rotate([50,35],d,[50,50]).toString())}}),$.mobile.activePage.find('svg[data-widget="icon.compass"]').on({update:function(c,
b){c.stopPropagation();var d=b[0]/$(this).attr("data-max")*2*Math.PI,e=[],e=e.concat(fx.rotate([40,50],d,[50,50]),fx.rotate([50,25],d,[50,50]),fx.rotate([60,50],d,[50,50]));$("#"+this.id+" #pin0").attr("points",e.toString());e=[];e=e.concat(fx.rotate([40,50],d,[50,50]),fx.rotate([50,75],d,[50,50]),fx.rotate([60,50],d,[50,50]));$("#"+this.id+" #pin1").attr("points",e.toString())}}),$.mobile.activePage.find('svg[data-widget="icon.graph"]').on({update:function(c,b){c.stopPropagation();var d=Math.round(b[0]/
$(this).attr("data-max")*70),e=$("#"+this.id+" #graph").attr("d").substr(8),f=e.split("L");8<f.length&&f.shift();for(var e="M 15,85 ",g=1;g<f.length;g++)e+="L "+(10*g+5)+","+f[g].substr(f[g].indexOf(",")+1).trim()+" ";$("#"+this.id+" #graph").attr("d",e+"L "+(10*g+5)+","+(85-d))}}),$(document).delegate('svg[data-widget="icon.light"]',{update:function(c,b){var d=Math.round(b[0]/$(this).attr("data-max")*10),e=1;$("#"+this.id+" g#light-rays line").each(function(){$(this).css("visibility",d>=e?"visible":
"hidden");e++})}}),$.mobile.activePage.find('svg[data-widget="icon.meter"]').on({update:function(c,b){c.stopPropagation();var d=b[0]/$(this).attr("data-max")*.44*Math.PI;$("#"+this.id+" #pointer").attr("points","50,85 "+fx.rotate([15,48],d,[50,85]).toString())}}),$.mobile.activePage.find('svg[data-widget="icon.shutter"]').on({update:function(c,b){c.stopPropagation();var d=Math.round(b[0]/$(this).attr("data-max")*38);fx.grid(this,d,[14,30],[86,68])}}),$.mobile.activePage.find('svg[data-widget="icon.ventilation"]').on({update:function(c,
b){c.stopPropagation();var d=4.5*(1-b[0]/$(this).attr("data-max"))+.5;$("#"+this.id+" #anim").attr("dur",0<b[0]?d:0)}}),$.mobile.activePage.find('svg[data-widget="icon.volume"]').on({update:function(c,b){c.stopPropagation();var d=Math.round(b[0]/$(this).attr("data-max")*71);fx.bar(this,d,[18,68],[89,50])}}),$.mobile.activePage.find('svg[data-widget="icon.windmill"]').on({update:function(c,b){c.stopPropagation();var d=4.5*(1-b[0]/$(this).attr("data-max"))+.5;$("#"+this.id+" #anim").attr("dur",0<b[0]?
d:0)}}),$.mobile.activePage.find('svg[data-widget="icon.windrose"]').on({update:function(c,b){c.stopPropagation();var d=b[0]/$(this).attr("data-max")*2*Math.PI,e=[],e=e.concat(fx.rotate([50,60],d,[50,50]),fx.rotate([37,71],d,[50,50]),fx.rotate([50,29],d,[50,50]));$("#"+this.id+" #pin0").attr("points",e.toString());e=[];e=e.concat(fx.rotate([50,60],d,[50,50]),fx.rotate([63,71],d,[50,50]),fx.rotate([50,29],d,[50,50]));$("#"+this.id+" #pin1").attr("points",e.toString())}}),$.mobile.activePage.find('svg[data-widget="icon.windsock"]').on({update:function(c,
b){c.stopPropagation();var d=b[0]/$(this).attr("data-max")*.45*Math.PI,e=[],e=e.concat(fx.rotate([70,40],d,[80,22]),[80,22],fx.rotate([90,40],d,[80,22]));$("#"+this.id+" #top").attr("points",e.toString());for(var f=0;3>f;f++)e=[],e=e.concat(fx.rotate([71+2*f,50+14*f],d,[80,22]),fx.rotate([89-2*f,50+14*f],d,[80,22]),fx.rotate([88-2*f,54+14*f],d,[80,22]),fx.rotate([72+2*f,54+14*f],d,[80,22])),$("#"+this.id+" #part"+f).attr("points",e.toString());e=[];e=e.concat(fx.rotate([70,40],d,[80,22]),fx.rotate([76,
82],d,[80,22]),fx.rotate([84,82],d,[80,22]),fx.rotate([90,40],d,[80,22]));$("#"+this.id+" #part3").attr("points",e.toString())}}),$.mobile.activePage.find('svg[data-widget="icon.zenith"]').on({update:function(c,b){c.stopPropagation();var d=b[0]/$(this).attr("data-max")*Math.PI;pt=fx.rotate([10,90],d,[50,90]);$("#"+this.id+" #sun").attr("x",pt[0]-50);$("#"+this.id+" #sun").attr("y",pt[1]-50)}}))});
$(document).delegate('canvas[data-widget="basic.colordisc"]',{init:function(p){p=parseFloat($(this).attr("data-colors"));var h=$(this)[0],c=100/($(this).attr("data-step")/2),b=Math.PI/(p+2)*2,d=-(Math.PI/2)+b,e=16.875/($(this).attr("data-step")/8),f=360/p;h.width=280;h.height=280;if(h.getContext){h=h.getContext("2d");h.beginPath();h.fillStyle="#888";h.shadowColor="rgba(96,96,96,0.4)";h.shadowOffsetX=2;h.shadowOffsetY=2;h.shadowBlur=4;h.arc(139,139,139,0,2*Math.PI,!1);h.fill();h.beginPath();h.shadowOffsetX=
0;h.shadowOffsetY=0;h.shadowBlur=0;h.fillStyle="#555";h.arc(139,139,138,0,2*Math.PI,!1);h.fill();for(var g,n=0;n<=p;n++){var k=d+n*b,m=1,q=n*f;for(g=c;100>=g;g+=c)h.beginPath(),h.fillStyle=fx.hsv2rgb(q,100,g),h.arc(139,139,m*e+e+1,k,k+b+.01,!1),h.arc(139,139,m*e,k+b+.01,k,!0),h.fill(),m+=1;for(g=100-c;g>=c;g-=c)h.beginPath(),h.fillStyle=fx.hsv2rgb(q,g,100),h.arc(139,139,m*e+e+1,k,k+b+.01,!1),h.arc(139,139,m*e,k+b+.01,k,!0),h.fill(),m+=1}--n;k=d+n*b;m=1;q=n*f;for(g=c;100>=g;g+=c/2)h.beginPath(),h.fillStyle=
fx.hsv2rgb(q,0,g),h.arc(139,139,m*e+e+1,k,k+2*b+.01,!1),h.arc(139,139,m*e,k+2*b+.01,k,!0),h.fill(),m+=1;h.beginPath();h.fillStyle="rgb(0,0,0)";h.arc(139,139,e+1,0,2*Math.PI,!1);h.fill()}}}); 
